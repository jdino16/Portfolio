<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Messages - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />
    <style>
        body { background: #0b0614; color: white; }
        .glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="min-h-screen p-6">
    <div class="max-w-6xl mx-auto">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold">Contact Messages</h1>
            <a href="/" class="btn bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg">
                <i class="ri-arrow-left-line mr-2"></i>Back to Portfolio
            </a>
        </div>

        <div class="glass rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold">All Messages</h2>
                <button onclick="refreshMessages()" class="btn bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
                    <i class="ri-refresh-line mr-2"></i>Refresh
                </button>
            </div>

            <div id="messagesContainer" class="space-y-4">
                <div class="text-center py-8">
                    <i class="ri-loader-4-line text-2xl animate-spin"></i>
                    <p class="mt-2">Loading messages...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load messages on page load
        document.addEventListener('DOMContentLoaded', loadMessages);

        async function loadMessages() {
            try {
                const response = await fetch('/api/contacts');
                const messages = await response.json();
                displayMessages(messages);
            } catch (error) {
                console.error('Error loading messages:', error);
                document.getElementById('messagesContainer').innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <i class="ri-error-warning-line text-2xl"></i>
                        <p class="mt-2">Failed to load messages</p>
                    </div>
                `;
            }
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesContainer');
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="ri-inbox-line text-2xl"></i>
                        <p class="mt-2">No messages yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = messages.map(msg => `
                <div class="glass rounded-lg p-4 border-l-4 ${getStatusColor(msg.status)}">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="font-semibold">${msg.name}</h3>
                                <span class="px-2 py-1 text-xs rounded-full ${getStatusBadge(msg.status)}">${msg.status}</span>
                                <span class="text-sm text-gray-400">${formatDate(msg.created_at)}</span>
                            </div>
                            <p class="text-sm text-gray-300 mb-2">${msg.email}</p>
                            <p class="text-white/80">${msg.message}</p>
                        </div>
                        <div class="flex gap-2 ml-4">
                            ${msg.status !== 'replied' ? `
                                <button onclick="updateStatus(${msg.id}, 'read')" 
                                        class="btn bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">
                                    <i class="ri-eye-line"></i>
                                </button>
                                <button onclick="updateStatus(${msg.id}, 'replied')" 
                                        class="btn bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm">
                                    <i class="ri-reply-line"></i>
                                </button>
                            ` : ''}
                            <button onclick="deleteMessage(${msg.id})" 
                                    class="btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'new': return 'border-blue-500';
                case 'read': return 'border-yellow-500';
                case 'replied': return 'border-green-500';
                default: return 'border-gray-500';
            }
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'new': return 'bg-blue-500/20 text-blue-300';
                case 'read': return 'bg-yellow-500/20 text-yellow-300';
                case 'replied': return 'bg-green-500/20 text-green-300';
                default: return 'bg-gray-500/20 text-gray-300';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        async function updateStatus(id, status) {
            try {
                const response = await fetch(`/api/contacts/${id}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });
                
                if (response.ok) {
                    loadMessages(); // Refresh the list
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }

        async function deleteMessage(id) {
            if (!confirm('Are you sure you want to delete this message?')) return;
            
            try {
                const response = await fetch(`/api/contacts/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadMessages(); // Refresh the list
                }
            } catch (error) {
                console.error('Error deleting message:', error);
            }
        }

        function refreshMessages() {
            loadMessages();
        }
    </script>
</body>
</html>
